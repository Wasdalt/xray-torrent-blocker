# ============================================================================
# xray-torrent-blocker Configuration
# Конфигурация xray-torrent-blocker
# ============================================================================

# Path to Xray log file for monitoring
# Путь к файлу логов Xray для мониторинга
LogFile: "/app/xray-logs/access.log"

# Block duration in minutes
# Длительность блокировки IP в минутах
BlockDuration: 10

# Tag for torrent traffic in Xray logs
# Тег торрент-трафика в логах Xray
TorrentTag: "TORRENT"

# Firewall mode: iptables or nft
# Режим файрвола: iptables или nft
BlockMode: "iptables"

# IPs that should never be blocked
# IP-адреса, которые никогда не блокировать
BypassIPS:
  - "127.0.0.1"
  - "::1"

# ============================================================================
# Username Processing / Обработка имени пользователя
# ============================================================================

# Regex to extract/transform username from logs
# Регулярное выражение для обработки username из логов
#
# Examples / Примеры:
#   "^(\\d+)\\.(.+)$"  - Marzban: "12345.username" → "username"
#   "^prefix_(.+)"    - Remove prefix / убрать префикс
#   "_tgid-(\\d+)"    - Telegram ID
#   "^(.+)$"          - Keep as-is / оставить как есть (default)
UsernameRegex: "^(.+)$"

# ============================================================================
# Webhook Settings / Настройки Webhook
# ============================================================================

# Send webhook notifications on block/unblock
# Отправлять webhook-уведомления при блокировке/разблокировке
SendWebhook: false

# Wait for webhook response BEFORE blocking
# Ждать ответа от webhook ПЕРЕД блокировкой
#
# true  - send request and wait for decision (ban/ignore/warn)
#       - отправить запрос и ждать решение
# false - block immediately, webhook for notification only
#       - блокировать сразу, webhook только для уведомления
WaitForWebhook: false

# Response timeout in seconds (if timeout, falls back to block)
# Таймаут ответа в секундах (при таймауте — блокировка)
WebhookTimeout: 5

# Webhook URL
WebhookURL: "https://your-api.com/webhook"

# JSON template for webhook request
# Шаблон JSON для webhook-запроса
# Params: username, ip, server, action, duration, timestamp
WebhookTemplate: '{"username":"%s","ip":"%s","server":"%s","action":"%s","duration":%d,"timestamp":"%s"}'

# Webhook headers (for auth)
# Заголовки webhook (для авторизации)
WebhookHeaders:
  Authorization: "Bearer your-token"
  Content-Type: "application/json"

# ============================================================================
# Storage / Хранение данных
# ============================================================================

# Directory for blocked IPs storage (persistent between restarts)
# Директория для хранения заблокированных IP
StorageDir: "/opt/tblocker"

# ============================================================================
# Environment Variables / Переменные окружения (for 3x-ui integration)
# ============================================================================
# These override settings above:
# Эти переменные переопределяют настройки выше:
#
# XUI_TORRENT_WEBHOOK_ENABLE=true
# XUI_TORRENT_WAIT_WEBHOOK=true
# XUI_TORRENT_WEBHOOK_URL=https://..
# XUI_TORRENT_WEBHOOK_TIMEOUT=5
# XUI_TORRENT_BAN_DURATION=10
# XUI_TORRENT_LOG_FILE=/var/log/...
# XUI_TORRENT_BLOCK_MODE=iptables
